"""Tests that we can define a new component and build from it"""
import sys, os
sys.path.insert(0, "..")
from prereq_tools import PreReqComponent
from prereq_tools import GitRepoRetriever

ENV = DefaultEnvironment()

OPTS = Variables()
REQS = PreReqComponent(ENV, OPTS)
PATH = os.path.realpath(os.path.join(Dir('#').abspath, "..",
                                     "components.py"))
REQS.preload(PATH)

REQS.define('pmix2',
            retriever=GitRepoRetriever('https://github.com/pmix/master'),
            commands=['./autogen.sh',
                      './configure --with-platform=optimized ' \
                      '--prefix=$PMIX2_PREFIX ' \
                      '--with-hwloc=$HWLOC_PREFIX',
                      'make', 'make install'],
            libs=['pmix'],
            headers=['pmix.h'],
            requires=['hwloc'],
           )

REQS.require(ENV, "pmix2")
ENV.Append(LIBS=['pthread'])
ENV.Program("foo2", Glob("*.c"))

Help(OPTS.GenerateHelpText(ENV))
