hosts:
  test_servers:
    - server-A
    - server-B
    - server-C
    - server-D
  client_partition: daos_client
orterun:
    allow_run_as_root: True
# This timeout must be longer than the test_timeout param (+30minutes)
timeout: 45000
logdir: /tmp/soak
server_config:
    name: daos_server
    provider: ofi+sockets
    servers:
        log_mask: ERR
        #bdev_class: nvme
        #bdev_list: ["0000:81:00.0","0000:da:00.0"]
        fabric_iface: ib0
        env_vars:
          - ABT_ENV_MAX_NUM_XSTREAMS=100
          - ABT_MAX_NUM_XSTREAMS=100
          - DAOS_MD_CAP=1024
          - CRT_CTX_SHARE_ADDR=0
          - CRT_TIMEOUT=2000
          - FI_SOCKETS_MAX_CONN_RETRY=1
          - FI_SOCKETS_CONN_TIMEOUT=2000

# pool_params - attributes of the pools to create; Currently only create one
pool_smoke:
    mode: 146
    name: daos_server
    scm_size: 4000000000
pool1:
    mode: 146
    name: daos_server
    scm_size: 50000000000
    svcn: 1
pool2:
    mode: 511
    name: daos_server
    scm_size: 50000000000
    svcn: 1
pool_reserved:
    mode: 511
    name: daos_server
    scm_size: 3000000000
container_reserved:
    akey_size: 5
    dkey_size: 5
    data_size: 32
    object_qty: 20
    record_qty: 10

# Harasser parameters
# Rebuild
rebuild:
    ranks_to_kill:
        - 2
    daos_oclass:
        - "RP_2GX"
        # - "RP_2GX"
        # - "RP_2G1"
        # - "RP_3G1"

# test_params - Defines the type of test to run and how long it runs
#               It also defines how many pools and jobs to create
#               name:                The name of the Avocado testcase
#               test_timeout:        The overall timeout in secs; soak12 will be
#                                    changed to 43200 once it is stable
#               test_iteration:      values 1 or -1; -1 is used to cause the
#                                    IOR -T x to end cmd.  i = 100000000
#                                    (does not seem to work)
#               nodesperjob:         slurm -N param; -1 indicates all nodes
#                                    in -partition
#               poollist:            defines pools to create for jobs
#               joblist:             defines workload per slurm scripts
#               harasserlist:        defines the harassers to run in test
# smoke test_params
smoke:
    name: soak_smoke
    test_timeout: 1200
    # maximum timeout for a single job in test in minutes
    job_timeout: 10
    # If slurm is not specified; launch jobs with Mpirun; {Sbatch|Srun|Mpirun}
    jobmanager: Sbatch
    nodesperjob: 1
    taskspernode:
      - 1
    poollist:
      - pool_smoke
    joblist:
      - ior_smoke
# SOAK stress test params
# Test will run for 60 minutes
soak_stress:
    name: soak_stress
    test_timeout: 43200
    # maximum timeout for a single job in test in minutes
    job_timeout: 20
    # If slurm is not specified; launch jobs with Mpirun; {Sbatch|Srun|Mpirun}
    jobmanager: Sbatch
    nodesperjob: 1
    # used for perfomance benchmarks
    taskspernode:
      - 1
      - 16
      #- 32
    poollist:
      - pool1
      - pool2
    joblist:
      - ior_daos
      - ior_mpiio
      #- dmg_create_destroy
      #- fio
      #- dfs
# SOAK harasser test params
# Test will run for 1 hour;
soak_harassers:
    name: soak_harassers
    test_timeout: 3600
    harasser_timeout: 300
    # maximum timeout for a single job in test in minutes
    job_timeout: 20
    # If slurm is not specified; launch jobs with Mpirun; {Sbatch|Srun|Mpirun}
    jobmanager: Sbatch
    nodesperjob: 1
    # used for perfomance benchmarks
    taskspernode:
      - 1
    poollist:
      - pool1
    joblist:
      - ior_daos
    harasserlist:
      - rebuild
    #- snapshot
    #- dmg_create_destroy

# Commandline parameters
# Benchmark and application params
# IOR params -a DAOS and -a MPIIO
# sequential
ior_smoke:
    api:
        - DAOS
        - MPIIO
    test_file: daos:testFile
    flags: -v -w -W -r -R
    block_size:
        - '64M'
    repetitions: 1
    transfer_size:
        - '4k'
        - '128k'
        - '1m'
    segment_count: 1
    daos_oclass:
        - 'SX'
ior_daos:
    api:
        - DAOS
    test_file: daos:testFile
    flags: -v -w -W -r -R
    block_size:
        - '64M'
        - '4M'
        - '32M'
    repetitions: 5
    transfer_size:
        - '4k'
        - '128k'
        - '1m'
        - '512K'
        - '64k'
    daos_oclass:
        - "SX"
        # - "RP_2GX"
        # - "RP_3GX"
        # - "RP_4GX"
ior_mpiio:
    api:
        - MPIIO
    test_file: daos:testFile
    flags: -v -w -W -r -R
    block_size:
        - '64M'
        # - '4M'
        # - '32M'
    repetitions: 5
    transfer_size:
        - '4k'
        - '128k'
        - '1m'
        - '512K'
        - '64k'
    daos_oclass:
        - "SX"
        # - "RP_2GX"
        # - "RP_3GX"
        # - "RP_4GX"
dmg_create_destroy:
    size:
      - 8M
      - 16M
      - 64M
      - 512M
      - 1G
      - 30G
