#!python

Import('env', 'PREREQS')

env.AppendUnique(LIBPATH=[Dir('.')])

if PREREQS is None:
        config = Configure(env)
        if config.CheckLibWithHeader('pmemobj', 'libpmemobj.h', language='C'):
                env.Append(LIBS=['pmemobj'])
        config.Finish()
else:
        PREREQS.require(env, 'nvml')

denv = env.Clone()

src = ['btree.c', 'debug.c', 'lru.c', 'hash.c', 'mem.c', 'misc.c', 'sort.c',
       'pool_map.c']
common = denv.SharedLibrary('libdaos_common', src)
denv.Install('$PREFIX/lib/', common)

denv.Append(CPPPATH = ['#/src/common'])
SConscript('tests/SConscript', exports='denv')
